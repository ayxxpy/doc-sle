<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_images_procedure.xml" version="5.0" xml:id="cha-images-procedure">
 <title>生イメージの展開</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>には、デバイスストレージ(メモリカード、USBメモリ、またはハードディスク)に直接展開できる生イメージが用意されています。イメージを展開できるデバイスタイプのオプションは、特定のハードウェアごとに異なるため、ベンダーのドキュメントに従ってください。
 </para>
 <para>
  展開されたイメージの初期設定を行うには、<xref linkend="pro-preparing-configuration-device"/>で説明するように設定データを準備し、デバイス(USBメモリなど)に設定データをコピーする必要があります。このデバイスは、初回の起動時にSLE Microを実行しているホストに接続する必要があります。
 </para>
 <para>
  セットアップを準備するには、2つの個別のデバイスが必要です。1つはSLE Microが実行する生ディスクイメージ用で、もう1つは設定メディアとして機能するものです。
 </para>
 <procedure xml:id="proc-prepare-image">
  <title>生のディスクイメージの準備</title>
  <step>
   <para>
    生イメージをダウンロードし、解凍します。
   </para>
<screen><prompt>tux &gt; </prompt>xz -d <replaceable>DOWNLOADED_IMAGE.raw.xz</replaceable></screen>
  </step>
  <step>
   <para>
    SLE Microを実行するデバイスに、解凍したイメージをコピーします。
   </para>
<screen><prompt>tux &gt; </prompt>dd if=<replaceable>DOWNLOADED_IMAGE.raw</replaceable> of=/dev/sd<replaceable>X</replaceable></screen>
  </step>
 </procedure>
 <para>
  次の手順では、設定デバイス(通常はUSBメモリ)を準備する方法を説明します。
 </para>
 <procedure xml:id="pro-preparing-configuration-device">
  <title>設定デバイスの準備</title>
  <step>
   <para>
    SLE Microでサポートされている任意のファイルシステム(Ext3、Ext4など)にディスクをフォーマットします:
   </para>
<screen>
<prompt>tux &gt; </prompt>sudo mkfs.ext4 /dev/sd<replaceable>Y</replaceable>
</screen>
  </step>
  <step>
   <para>
    デバイスのラベルを、<literal>ignition</literal> (IgnitionまたはCombustionのいずれかが使用されている場合)または<literal>combustion</literal> (Combustionのみが使用されている場合)に設定します。Ext4ファイルシステムの場合は、次のように設定します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo e2label /dev/sd<replaceable>Y</replaceable> ignition</screen>
   <para>
    仮想化システムまたはハードウェアがサポートしている任意のタイプの設定ストレージメディアを使用できます(ISOイメージ、USBメモリなど)。
   </para>
  </step>
  <step>
   <para>
    デバイスをマウントします。
   </para>
<screen>
<prompt>tux &gt; </prompt>sudo mount /dev/sdY /mnt
</screen>
  </step>
  <step>
   <para>
    使用する設定ツールに応じて、<xref linkend="cha-images-ignition"/>または<xref linkend="cha-images-combustion"/>に示すようにディレクトリ構造を作成します。
   </para>
<screen>
<prompt>tux &gt; </prompt>sudo mkdir -p /mnt/ignition/
</screen>
   <para>
    あるいは、
   </para>
<screen>
<prompt>tux &gt; </prompt>sudo mkdir -p /mnt/combustion/
</screen>
  </step>
  <step>
   <para>
    初めて起動する前に、<xref linkend="cha-images-ignition" xrefstyle="template:Ignition"/>または<xref linkend="cha-images-combustion" xrefstyle="template:Combustion"/>で使用される設定のすべての要素を準備します。システムにログインするには、<systemitem class="username">root</systemitem>用のパスワードを指定するか、パスワードのない認証を設定する必要があります。そうしない場合、初回の起動後にシステムにアクセスできなくなります。
   </para>
  </step>
 </procedure>
 <para>
  初回の起動後に、コマンドラインツール<command>SUSEConnect</command>を使用して、SUSE Linux Enterprise Microインスタンスを登録する必要があります。詳細については、<xref linkend="sec-images-registration"/>を参照してください。
 </para>
 <para>
  SLE Microには、ライブパッチ用の拡張機能があります。この拡張機能を使用するには、インストール済みシステムからサブスクリプションに拡張機能を追加する必要があります。詳細については、<xref linkend="sec-adding-extension"/>を参照してください。
 </para>
 <sect1 xml:id="sec-images-registration">
  <title>登録</title>

  <para>
   システムの登録は、<command>SUSEConnect</command>を使用してコマンドラインから実行できます。このセクションの説明対象以外の情報については、<command>SUSEConnect
   --help</command>でのインラインドキュメントを参照してください。
  </para>

  <procedure>
   <title>SUSEConnectでの製品の登録</title>
   <step>
    <para>
     SUSE Customer Centerで、<phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>を登録するには、次のように<command>SUSEConnect</command>を実行します。
    </para>
<screen><prompt role="root">root # </prompt>SUSEConnect -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable></screen>
    <para>
     ローカル登録サーバで登録するには、さらに次のようにサーバへのURLも入力します。
    </para>
<screen><prompt role="root">root # </prompt>SUSEConnect -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable> \
--url "https://suse_register.example.com/"</screen>
    <para>
     <replaceable>REGISTRATION_CODE</replaceable>は、<phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>と一緒に受け取った登録コードで置き換えます。<replaceable>EMAIL_ADDRESS</replaceable>は、各自または各自の組織が登録の管理に使用しているSUSEアカウントに関連付けられた電子メールアドレスで置き換えます。
    </para>
   </step>
   <step>
    <para>
     これで、<phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>が登録されました。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-adding-extension">
  <title>拡張機能の管理</title>

  <para>
   SLE Microでは、カーネルライブパッチ拡張機能をサポートしています。拡張機能には、追加のサブスクリプションが必要になる場合があることに注意してください。
  </para>

  <note>
   <title><literal>SUSE Linux Enterprise Live Patching</literal>の可用性</title>
   <para>
    <literal>SUSE Linux Enterprise Live Patching</literal>拡張機能は、x86 (リアルタイムカーネルを除く)およびIBM Zアーキテクチャでのみ利用できます。
   </para>
  </note>

  <para>
   拡張機能のアクティブ化または非アクティブ化はトランザクション更新として実行され、新しいスナップショットが作成されるため、システムを再起動して新しいスナップショットを起動し、変更を適用する必要があります。
  </para>

  <sect2 xml:id="sec-slemicro-live-patching">
   <title><literal>SUSE Linux Enterprise Live Patching</literal>のアクティブ化</title>
   <para>
    ライブパッチ拡張機能をアクティブ化する必要がある場合は、次のコマンドを実行して、使用可能な拡張機能を一覧表示します。
   </para>
<screen><prompt role="root">root # </prompt>transactional-update --quiet register -list-extensions</screen>
   <para>
    出力には、ライブパッチ拡張機能をアクティブ化する方法のコマンドが含まれています。
   </para>
<screen>
<prompt role="root">root # </prompt>transactional-update register -p sle-module-live-patching/15.3/x86_64 \
  -r <replaceable>registration code</replaceable>
</screen>
   <para>
    <literal>SUSE Linux Enterprise Live Patching</literal>拡張機能をアクティブ化した後で、次のように<filename>/etc/zypp/zypp.conf</filename>ファイルで<literal>libzypp</literal>を設定します。
   </para>
   <variablelist>
    <varlistentry>
     <term><literal>multiversion = provides:multiversion(kernel)</literal></term>
     <listitem>
      <para>
       これは、システムにパッチを適用している間、現在のカーネルを実行し続けるためです。これを設定しないと、カーネル更新の適用中に依存関係の競合が発生する可能性があります。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>multiversion.kernels = latest</literal></term>
     <listitem>
      <para>
       ライブパッチの適用後、新しいスナップショットでカーネルのクリーンアップが実行されます。設定されていない場合、スナップショットは以前のカーネルを保持し、以前のカーネルでもカーネルの更新を実行します。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    また、<filename>/etc/sysconfig/livepatching</filename>ファイルで、<literal>LIVEPATCH_KERNEL='always'</literal>を設定します。
   </para>
   <note>
    <title>一致するバージョンの<literal>kernel-default-livepatch</literal>とカーネル</title>
    <para>
     カーネルアップグレード後もライブパッチが確実にインストールされるようにするには、一致するバージョンの<literal>kernel-default-livepatch</literal>パッケージをインストールします。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-disable-live-patching">
   <title><literal>SUSE Linux Enterprise Live Patching</literal>の非アクティブ化</title>
   <para>
    拡張機能を非アクティブ化するには、次のコマンドを実行します。
   </para>
<screen>
<prompt role="root">root # </prompt>transactional-update register -d \
  -p sle-module-live-patching/15.3/x86_64
</screen>
  </sect2>
 </sect1>
</chapter>
