<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_images_procedure.xml" version="5.0" xml:id="cha-images-procedure">
 <title>Implementieren von Raw-Images</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> bietet Raw-Images, die direkt auf Ihrem Gerätespeicher (Speicherkarte, USB-Speicherstick oder Festplatte) bereitgestellt werden können. Die Optionen für die Gerätetypen, auf denen Sie das Image bereitstellen können, sind von Ihrer jeweiligen Hardware abhängig; bitte beachten Sie die Dokumentation des Herstellers.
 </para>
 <para>
  Für die anfängliche Konfiguration des bereitgestellten Images müssen Sie die Konfigurationsdaten gemäß <xref linkend="pro-preparing-configuration-device"/> vorbereiten und dann auf ein Speichergerät (z. B. USB-Speicherstick) kopieren. Das Gerät muss beim ersten Starten mit dem Host verbunden sein, auf dem SLE Micro ausgeführt wird.
 </para>
 <para>
  Zum Vorbereiten der Einrichtung benötigen Sie zwei separate Geräte. Ein Gerät für das Raw-Datenträger-Image, auf dem SLE Micro ausgeführt wird, und ein zweites Gerät, das als Konfigurationsmedium fungiert.
 </para>
 <procedure xml:id="proc-prepare-image">
  <title>Vorbereiten des Raw-Datenträger-Images</title>
  <step>
   <para>
    Laden Sie das Raw-Image herunter und dekomprimieren Sie es:
   </para>
<screen><prompt>tux &gt; </prompt>xz -d <replaceable>DOWNLOADED_IMAGE.raw.xz</replaceable></screen>
  </step>
  <step>
   <para>
    Kopieren Sie das dekomprimierte Image auf das Gerät, auf dem SLE Micro ausgeführt werden soll:
   </para>
<screen><prompt>tux &gt; </prompt>dd if=<replaceable>DOWNLOADED_IMAGE.raw</replaceable> of=/dev/sd<replaceable>X</replaceable></screen>
  </step>
 </procedure>
 <para>
  Mti dem folgenden Verfahren bereiten Sie das Konfigurationsgerät (in der Regel ein USB-Speicherstick) vor.
 </para>
 <procedure xml:id="pro-preparing-configuration-device">
  <title>Vorbereiten des Konfigurationsgeräts</title>
  <step>
   <para>
    Formatieren Sie den Datenträger mit einem Dateisystem, das von SLE Micro unterstützt wird: Ext3, Ext4 usw.:
   </para>
<screen>
<prompt>tux &gt; </prompt>sudo mkfs.ext4 /dev/sd<replaceable>Y</replaceable>
</screen>
  </step>
  <step>
   <para>
    Legen Sie als Gerätekennung entweder <literal>ignition</literal> (wenn entweder Ignition oder Combustion verwendet wird) oder <literal>combustion</literal> fest (wenn nur Combustion verwendet wird). Ext4-Dateisystem:
   </para>
<screen><prompt>tux &gt; </prompt>sudo e2label /dev/sd<replaceable>Y</replaceable> ignition</screen>
   <para>
    Sie können ein beliebiges Konfigurationsspeichermedium verwenden, das von Ihrem Virtualisierungssystem oder Ihrer Hardware unterstützt wird: ISO-Image, USB-Speicherstick usw.
   </para>
  </step>
  <step>
   <para>
    Hängen Sie das Gerät ein:
   </para>
<screen>
<prompt>tux &gt; </prompt>sudo mount /dev/sdY /mnt
</screen>
  </step>
  <step>
   <para>
    Erstellen Sie die Verzeichnisstruktur gemäß <xref linkend="cha-images-ignition"/> oder <xref linkend="cha-images-combustion"/>, je nach dem verwendeten Konfigurationstool:
   </para>
<screen>
<prompt>tux &gt; </prompt>sudo mkdir -p /mnt/ignition/
</screen>
   <para>
    oder:
   </para>
<screen>
<prompt>tux &gt; </prompt>sudo mkdir -p /mnt/combustion/
</screen>
  </step>
  <step>
   <para>
    Bereiten Sie vor dem ersten Starten alle Elemente der Konfiguration vor, die von <xref linkend="cha-images-ignition" xrefstyle="template:Ignition"/> oder <xref linkend="cha-images-combustion" xrefstyle="template:Combustion"/> verwendet werden. Zum Anmelden bei Ihrem Symptom müssen Sie ein Passwort für <systemitem class="username">root</systemitem> angeben oder die passwortlose Authentifizierung einrichten. Ansonsten ist nach dem ersten Starten kein Zugriff auf das System möglich.
   </para>
  </step>
 </procedure>
 <para>
  Nach dem ersten Starten müssen Sie Ihre SUSE Linux Enterprise Micro-Instanz mit dem Befehlszeilentool <command>SUSEConnect</command> registrieren. Detaillierte Informationen finden Sie in <xref linkend="sec-images-registration"/>.
 </para>
 <para>
  SLE Micro bietet eine Erweiterung für das Live-Patching. Soll diese Erweiterung verwendet werden, nehmen Sie sie vom installierten System aus in Ihr Abonnement auf. Detaillierte Informationen finden Sie in <xref linkend="sec-adding-extension"/>.
 </para>
 <sect1 xml:id="sec-images-registration">
  <title>Registrierung</title>

  <para>
   Mit <command>SUSEConnect</command> können Sie das System über die Befehlszeile registrieren. Informationen, die über den Umfang dieses Abschnitts hinausgehen, finden Sie in der Inline-Dokumentation zu <command>SUSEConnect
   --help</command>.
  </para>

  <procedure>
   <title>Produktregistrierung mit SUSE Connect</title>
   <step>
    <para>
     Führen Sie zur Registrierung von <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> beim SUSE Customer Center <command>SUSEConnect</command> wie folgt aus:
    </para>
<screen><prompt role="root">root # </prompt>SUSEConnect -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable></screen>
    <para>
     Soll die Registrierung über einen lokalen Registrierungsserver erfolgen, geben Sie zusätzlich die URL des Servers an:
    </para>
<screen><prompt role="root">root # </prompt>SUSEConnect -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable> \
--url "https://suse_register.example.com/"</screen>
    <para>
     Ersetzen Sie <replaceable>REGISTRATION_CODE</replaceable> durch den Registrierungscode, den Sie mit Ihrer Version von <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> erhalten haben. Ersetzen Sie <replaceable>EMAIL_ADDRESS</replaceable> durch die E-Mail-Adresse für das SUSE-Konto, mit dem Sie oder Ihr Unternehmen die Abonnements verwalten.
    </para>
   </step>
   <step>
    <para>
     <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> ist nun registriert.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-adding-extension">
  <title>Verwalten von Erweiterungen</title>

  <para>
   SLE Micro unterstützt die Kernel-Live-Patching-Erweiterung. Für diese Erweiterung ist unter Umständen ein zusätzliches Abonnement erforderlich.
  </para>

  <note>
   <title>Verfügbar von <literal>SUSE Linux Enterprise Live Patching</literal></title>
   <para>
    Die Erweiterung <literal>SUSE Linux Enterprise Live Patching</literal> ist nur für x86- (ausgenommen Echtzeit-Kernel) und IBM Z-Architekturen verfügbar.
   </para>
  </note>

  <para>
   Die Aktivierung oder Deaktivierung der Erweiterung wird in Form einer Transaktionsaktualisierung ausgeführt und erfordert daher einen neuen Snapshot. Sie müssen daher Ihr System neu starten, damit der Start im neuen Snapshot erfolgt und die Änderungen übernommen werden.
  </para>

  <sect2 xml:id="sec-slemicro-live-patching">
   <title>Aktivieren von <literal>SUSE Linux Enterprise Live Patching</literal></title>
   <para>
    Falls Sie die Live-Patching-Erweiterung aktivieren müssen, rufen Sie die verfügbaren Erweiterungen mit folgendem Befehl ab:
   </para>
<screen><prompt role="root">root # </prompt>transactional-update --quiet register -list-extensions</screen>
   <para>
    Als Ausgabe erhalten Sie einen Befehl, mit dem Sie die Live-Patching-Erweiterung aktivieren:
   </para>
<screen>
<prompt role="root">root # </prompt>transactional-update register -p sle-module-live-patching/15.3/x86_64 \
  -r <replaceable>registration code</replaceable>
</screen>
   <para>
    Nach Aktivierung der Erweiterung <literal>SUSE Linux Enterprise Live Patching</literal> konfigurieren Sie <literal>libzypp</literal> in der Datei <filename>/etc/zypp/zypp.conf</filename> wie folgt:
   </para>
   <variablelist>
    <varlistentry>
     <term><literal>multiversion = provides:multiversion(kernel)</literal></term>
     <listitem>
      <para>
       Damit wird der aktuelle Kernel auch beim Patching des Systems weiterhin ausgeführt; ansonsten können Abhängigkeitskonflikte bei der Anwendung von Kernel-Aktualisierungen auftreten.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>multiversion.kernels = latest</literal></term>
     <listitem>
      <para>
       Nach Anwendung des Live-Patches werden die Kernel im neuen Snapshot bereinigt. Wenn dies nicht angegeben ist, behält der Snapshot den bisherigen Kernel bei und wendet auch Kernel-Aktualisierungen auf den vorherigen Kernel an.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Legen Sie außerdem <literal>LIVEPATCH_KERNEL='always'</literal> in der Datei <filename>/etc/sysconfig/livepatching</filename> fest.
   </para>
   <note>
    <title>Passende Version von <literal>kernel-default-livepatch</literal> und Kernel</title>
    <para>
     Damit die Live-Patches auch nach einem Kernel-Upgrade installiert werden, installieren Sie die passende Version des Pakets <literal>kernel-default-livepatch</literal>.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-disable-live-patching">
   <title>Deaktivieren von <literal>SUSE Linux Enterprise Live Patching</literal></title>
   <para>
    Führen Sie den folgenden Befehl aus, um die Erweiterung zu deaktivieren:
   </para>
<screen>
<prompt role="root">root # </prompt>transactional-update register -d \
  -p sle-module-live-patching/15.3/x86_64
</screen>
  </sect2>
 </sect1>
</chapter>
