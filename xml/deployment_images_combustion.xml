<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>

<chapter version="5.0" xml:id="cha-images-combustion"
 xmlns="http://docbook.org/ns/docbook"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Configuration by using Combustion</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  
 </info>
 <para>
    This chapter describes Combustion&dash;the tool used to configure your system according to your configuration on first boot.
   </para>
 <sect1 xml:id="sec-about-combustion">
 <title>About Combustion</title>
 <para>
 Combustion is a dracut module that enables you to configure your system on first boot. Combustion reads a provided <filename>script</filename> and executes commands in it and thus perform changes to the file system. You can use Combustion to change the default partitions, set users' passwords, create files, install packages, etc.
 </para>
 <para>
 Combustion is a dracut module that is invoked after the <literal>ignition.firstboot</literal> argument is passed to the kernel command line. Combustion then reads configuration from <filename>script</filename>. If the network flag has been found in <filename>script</filename>, Combustion tries to configure network. After <literal>/sysroot</literal> is mounted, Combustion tries to activate all mountpoints in <filename>/etc/fstab</filename> and then call the <command>transactional-update</command> to apply other changes (like setting &rootuser; password or install packages). 
 </para>
 <para>
 When using Combustion, you need to label the configuration device to <literal>combustion</literal>, create a specific directory structure in your configuration media and include a configuration named <filename>script</filename>. In the root directory create a directory&dash;<filename>combustion</filename> and place the <filename>script</filename> into this directory. The directory structure then should look as follows:
 </para>
 <screen>
    &lt;root directory&gt;
	- combustion
		- script
		- other files
	</screen>
	<para> 
	You can use Combustion to configure your QEMU/KVM virtual machine. In this case, pass the location of the <filename>script</filename> by using the <literal>fw_cfg</literal> parameter of the <command>qemu</command> command:
	</para>
	<screen>
	-fw_cfg name=opt/org.opensuse.combustion/script,file=/var/combustion-script
	</screen>
	<para>
	Combustion can be used along with Ignition. If you intend to do so, label your configuration media <literal>ignition</literal> and include the <filename>ignition</filename> directory with the <filename>config.ign</filename>to your directory structure as shown below:
	</para>
	<screen>
&lt;root directory&gt;
	-combustion
		- script
		- other files
	- ignition 
		- config.ign
	</screen>
   <para>
   In this case Ignition runs before Combustion.
   </para>
 </sect1>
 <sect1 xml:id="sec-combustion-script">
 <title>The <filename>script</filename> configuration file</title>
 <para>
 The <filename>script</filename> configuration file is a set of commands that are executed on your system in a transactional-update shell. This section provides ecxamples how to perform various configuration tasks by using Combustion.
 </para>
 <para>
 As the <filename>script</filename> file is interpreted by bash, make sure to include the interpreteur declaration at the beginning:
 </para>
 <screen>
 #!/bin/sh
 </screen>
 <sect2 xml:id="sec-script-network">
 <title>Network configuration</title>
 <para>
 In case you want to configure network during the first boot, add the following statement to your <filename>script</filename>:
 </para>
 <screen>
 # combustion: network
 </screen>
 <para>
 Using this statement will pass the <literal>rd.neednet=1</literal> argument to dracut.IF you do not use the statement, the default <literal>dhcp</literal> will be used on all available interfaces.
 </para>
 </sect2>
 <sect2 xml:id="sec-script-partitioning">
 <title>Partitioning</title>
 </sect2>
 <sect2 xml:id="sex-cript-security">
 <title>Setting a password for &rootuser;</title>
 </sect2>
 <sect2 xml:id="sec-script-files">
 <title>Creating files and directories</title>
 </sect2>
 <sect2 xml:id="sec-script-install">
 <title>Installing packages</title>
 </sect2>
 </sect1>
 </chapter>
